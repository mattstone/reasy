<div class="admin-content">
  <%# Back Link %>
  <div class="mb-4">
    <%= link_to admin_reviews_path, class: "btn btn-ghost btn-sm" do %>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Back to Reviews
    <% end %>
  </div>

  <%# Review Header %>
  <div class="admin-user-header mb-6">
    <div class="admin-user-header-main">
      <div style="width: 64px; height: 64px; background: var(--color-accent-100); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="var(--color-accent)" stroke="var(--color-accent)" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
      </div>
      <div class="admin-user-header-info">
        <h1 class="admin-user-name">Review #<%= @review.id %></h1>
        <p class="admin-user-email">
          <%= @review.reviewer&.name || "Anonymous" %> reviewed <%= @review.reviewee&.name || "Unknown" %>
        </p>
        <div class="admin-user-badges">
          <span class="badge <%= @review.published? ? 'badge-green' : (@review.held? ? 'badge-orange' : 'badge-gray') %>">
            <%= @review.status&.humanize || "Pending" %>
          </span>
          <% if @review.disputed? %>
            <span class="badge badge-red">Disputed</span>
          <% end %>
          <% if @review.hold_until && @review.hold_until > Time.current %>
            <span class="badge badge-blue">
              Hold expires in <%= time_ago_in_words(@review.hold_until) %>
            </span>
          <% end %>
        </div>
      </div>
    </div>
    <div class="admin-user-header-actions">
      <% unless @review.published? %>
        <%= button_to publish_admin_review_path(@review), method: :post, class: "btn btn-primary" do %>
          Publish Review
        <% end %>
      <% end %>
      <% unless @review.held? %>
        <%= button_to hold_admin_review_path(@review), method: :post, class: "btn btn-secondary" do %>
          Put on Hold
        <% end %>
      <% end %>
      <%= button_to remove_admin_review_path(@review), method: :post, class: "btn btn-danger", data: { turbo_confirm: "Are you sure you want to remove this review?" } do %>
        Remove Review
      <% end %>
    </div>
  </div>

  <div class="admin-grid-2">
    <%# Review Content %>
    <div class="admin-panel">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">Review Content</h2>
      </div>
      <div class="admin-panel-content">
        <%# Rating %>
        <div style="display: flex; gap: var(--space-1); margin-bottom: var(--space-4);">
          <% 5.times do |i| %>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="<%= i < @review.rating ? 'var(--color-accent)' : 'none' %>" stroke="var(--color-accent)" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          <% end %>
          <span style="margin-left: var(--space-2); color: var(--color-gray-600);">
            <%= @review.rating %> out of 5
          </span>
        </div>

        <%# Category Ratings %>
        <% if @review.respond_to?(:category_ratings) && @review.category_ratings.present? %>
          <div style="margin-bottom: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); font-weight: 600; color: var(--color-gray-700); margin-bottom: var(--space-2);">Category Ratings</h4>
            <% @review.category_ratings.each do |category, rating| %>
              <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-1);">
                <span style="font-size: var(--font-size-sm); color: var(--color-gray-600);"><%= category.humanize %></span>
                <span style="font-size: var(--font-size-sm); font-weight: 500;"><%= rating %>/5</span>
              </div>
            <% end %>
          </div>
        <% end %>

        <%# Review Text %>
        <div style="border-top: 1px solid var(--color-gray-100); padding-top: var(--space-4);">
          <p style="font-size: var(--font-size-sm); color: var(--color-gray-700); line-height: 1.6;">
            <%= @review.content %>
          </p>
        </div>

        <%# Response %>
        <% if @review.response.present? %>
          <div style="margin-top: var(--space-4); padding: var(--space-4); background: var(--color-gray-50); border-radius: var(--radius-md);">
            <h4 style="font-size: var(--font-size-sm); font-weight: 600; color: var(--color-gray-700); margin-bottom: var(--space-2);">
              Response from <%= @review.reviewee&.name || "Reviewee" %>
            </h4>
            <p style="font-size: var(--font-size-sm); color: var(--color-gray-600); line-height: 1.6;">
              <%= @review.response %>
            </p>
          </div>
        <% end %>
      </div>
    </div>

    <%# Details %>
    <div class="admin-panel">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">Details</h2>
      </div>
      <div class="admin-detail-list">
        <div class="admin-detail-row">
          <span class="admin-detail-label">Reviewer</span>
          <span class="admin-detail-value">
            <% if @review.reviewer %>
              <%= link_to @review.reviewer.name, admin_user_path(@review.reviewer) %>
            <% else %>
              Anonymous
            <% end %>
          </span>
        </div>
        <div class="admin-detail-row">
          <span class="admin-detail-label">Reviewee</span>
          <span class="admin-detail-value">
            <% if @review.reviewee %>
              <%= link_to @review.reviewee.name, admin_user_path(@review.reviewee) %>
            <% else %>
              Unknown
            <% end %>
          </span>
        </div>
        <div class="admin-detail-row">
          <span class="admin-detail-label">Review Type</span>
          <span class="admin-detail-value"><%= @review.review_type&.humanize || "General" %></span>
        </div>
        <div class="admin-detail-row">
          <span class="admin-detail-label">Created</span>
          <span class="admin-detail-value"><%= @review.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
        </div>
        <div class="admin-detail-row">
          <span class="admin-detail-label">Hold Until</span>
          <span class="admin-detail-value">
            <% if @review.hold_until %>
              <%= @review.hold_until.strftime("%B %d, %Y at %I:%M %p") %>
            <% else %>
              N/A
            <% end %>
          </span>
        </div>
        <div class="admin-detail-row">
          <span class="admin-detail-label">Published At</span>
          <span class="admin-detail-value">
            <% if @review.published_at %>
              <%= @review.published_at.strftime("%B %d, %Y at %I:%M %p") %>
            <% else %>
              Not published
            <% end %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <%# Disputes %>
  <% if @review.disputes.any? %>
    <div class="admin-panel mt-6">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">Disputes (<%= @review.disputes.count %>)</h2>
      </div>
      <% @review.disputes.each do |dispute| %>
        <div style="padding: var(--space-4) var(--space-5); border-bottom: 1px solid var(--color-gray-100);">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-2);">
            <div>
              <span class="badge badge-sm <%= dispute.status == 'resolved' ? 'badge-green' : 'badge-orange' %>">
                <%= dispute.status&.humanize || "Pending" %>
              </span>
              <span style="font-size: var(--font-size-xs); color: var(--color-gray-500); margin-left: var(--space-2);">
                Filed <%= time_ago_in_words(dispute.created_at) %> ago
              </span>
            </div>
            <%= link_to "View Dispute", admin_review_dispute_path(dispute), class: "btn btn-ghost btn-sm" %>
          </div>
          <p style="font-size: var(--font-size-sm); color: var(--color-gray-600);">
            <strong>Reason:</strong> <%= dispute.reason&.humanize || "Other" %>
          </p>
          <p style="font-size: var(--font-size-sm); color: var(--color-gray-600); margin-top: var(--space-1);">
            <%= truncate(dispute.explanation, length: 200) %>
          </p>
        </div>
      <% end %>
    </div>
  <% end %>

  <%# Admin Notes %>
  <div class="admin-panel mt-6">
    <div class="admin-panel-header">
      <h2 class="admin-panel-title">Admin Notes</h2>
    </div>
    <div class="admin-panel-content">
      <%= form_with url: hold_admin_review_path(@review), method: :post, local: true do |f| %>
        <div class="form-group">
          <label class="form-label">Add notes when putting review on hold:</label>
          <textarea name="reason" class="form-control" rows="3" placeholder="Enter reason for holding this review..."></textarea>
        </div>
        <button type="submit" class="btn btn-secondary">Hold with Notes</button>
      <% end %>
    </div>
  </div>
</div>
