<div class="admin-content">
  <%# Page Header %>
  <div class="admin-page-header">
    <div>
      <h1 class="admin-page-title">Platform Usage</h1>
      <p class="admin-page-subtitle">Activity patterns, page views, and search analytics</p>
    </div>
    <div class="admin-section-nav">
      <%= link_to "System Status", admin_system_root_path, class: "admin-section-nav-item" %>
      <%= link_to "Platform Usage", admin_system_usage_path, class: "admin-section-nav-item active" %>
      <%= link_to "AI Analytics", admin_system_ai_path, class: "admin-section-nav-item" %>
      <%= link_to "Audit Activity", admin_system_audit_path, class: "admin-section-nav-item" %>
    </div>
  </div>

  <%# Hero Metrics %>
  <div class="admin-metric-hero">
    <div class="admin-metric-hero-card">
      <div class="admin-metric-hero-card-icon green">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </div>
      <div class="admin-metric-hero-value"><%= number_with_delimiter(@page_views_today) %></div>
      <div class="admin-metric-hero-label">Actions Today</div>
      <div class="admin-metric-hero-change neutral">Audit log entries</div>
    </div>

    <div class="admin-metric-hero-card">
      <div class="admin-metric-hero-card-icon blue">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
      </div>
      <div class="admin-metric-hero-value"><%= number_with_delimiter(@page_views_week) %></div>
      <div class="admin-metric-hero-label">Actions This Week</div>
      <div class="admin-metric-hero-change neutral">Last 7 days</div>
    </div>

    <div class="admin-metric-hero-card">
      <div class="admin-metric-hero-card-icon orange">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
      </div>
      <div class="admin-metric-hero-value"><%= number_with_delimiter(@page_views_month) %></div>
      <div class="admin-metric-hero-label">Actions This Month</div>
      <div class="admin-metric-hero-change neutral">Last 30 days</div>
    </div>

    <div class="admin-metric-hero-card">
      <div class="admin-metric-hero-card-icon purple">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </div>
      <div class="admin-metric-hero-value"><%= number_with_delimiter(@top_actions.values.sum) %></div>
      <div class="admin-metric-hero-label">Total Actions (7d)</div>
      <div class="admin-metric-hero-change neutral">All activity types</div>
    </div>
  </div>

  <%# Charts and Data %>
  <div class="admin-grid-2 mb-6">
    <div class="admin-chart-card">
      <div class="admin-chart-card-header">
        <div>
          <h3 class="admin-chart-card-title">Hourly Activity</h3>
          <p class="admin-chart-card-subtitle">Activity distribution by hour</p>
        </div>
      </div>
      <div class="admin-chart-container"
           data-controller="d3-chart"
           data-d3-chart-type-value="heatmap"
           data-d3-chart-data-value="<%= @hourly_activity.to_json %>"
           data-d3-chart-height-value="200">
      </div>
    </div>

    <div class="admin-panel">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">Top Actions (7 days)</h2>
      </div>
      <div class="admin-panel-content">
        <ul class="admin-data-list">
          <% @top_actions.first(8).each do |action, count| %>
            <li class="admin-data-list-item">
              <div class="admin-data-list-bar">
                <span class="admin-data-list-label"><%= action.humanize %></span>
                <% max_count = @top_actions.values.max || 1 %>
                <div class="admin-data-list-bar-fill" style="width: <%= (count.to_f / max_count * 100).round %>px;"></div>
              </div>
              <span class="admin-data-list-value"><%= number_with_delimiter(count) %></span>
            </li>
          <% end %>
          <% if @top_actions.empty? %>
            <li class="admin-data-list-item">
              <span class="text-muted">No activity recorded</span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <%# Browser Stats %>
  <div class="admin-grid-2">
    <div class="admin-chart-card">
      <div class="admin-chart-card-header">
        <div>
          <h3 class="admin-chart-card-title">Property Views</h3>
          <p class="admin-chart-card-subtitle">Last 30 days</p>
        </div>
      </div>
      <div class="admin-chart-container"
           data-controller="d3-chart"
           data-d3-chart-type-value="area"
           data-d3-chart-data-value="<%= @property_views.to_json %>"
           data-d3-chart-height-value="250"
           data-d3-chart-colors-value='["#3b82f6"]'>
      </div>
    </div>

    <div class="admin-panel">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">Browser Usage</h2>
      </div>
      <div class="admin-panel-content">
        <ul class="admin-data-list">
          <% @user_agents.each do |browser, count| %>
            <li class="admin-data-list-item">
              <span class="admin-data-list-label"><%= browser %></span>
              <span class="admin-data-list-value"><%= number_with_delimiter(count) %></span>
            </li>
          <% end %>
          <% if @user_agents.empty? %>
            <li class="admin-data-list-item">
              <span class="text-muted">No browser data available</span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
