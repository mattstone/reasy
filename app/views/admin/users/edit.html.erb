<div class="admin-content">
  <%# Back Link %>
  <div class="mb-4">
    <%= link_to admin_user_path(@user), class: "btn btn-ghost btn-sm" do %>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Back to User
    <% end %>
  </div>

  <%# Page Header %>
  <div class="admin-page-header mb-6">
    <div>
      <h1 class="admin-page-title">Edit User</h1>
      <p class="admin-page-subtitle"><%= @user.name %> (<%= @user.email %>)</p>
    </div>
  </div>

  <div class="admin-grid-2">
    <%# Edit Form %>
    <div class="admin-panel">
      <div class="admin-panel-header">
        <h2 class="admin-panel-title">User Details</h2>
      </div>
      <div class="admin-settings-form">
        <%= form_with model: [:admin, @user], local: true do |f| %>
          <% if @user.errors.any? %>
            <div class="alert alert-error mb-4">
              <ul style="margin: 0; padding-left: var(--space-4);">
                <% @user.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="form-group">
            <label class="form-label">Name</label>
            <%= f.text_field :name, class: "form-control" %>
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <%= f.email_field :email, class: "form-control" %>
          </div>

          <div class="form-group">
            <label class="form-label">Phone</label>
            <%= f.text_field :phone, class: "form-control" %>
          </div>

          <div class="form-group">
            <label class="form-label">KYC Status</label>
            <%= f.select :kyc_status, [
              ["Pending", "pending"],
              ["Submitted", "submitted"],
              ["Under Review", "under_review"],
              ["Verified", "verified"],
              ["Rejected", "rejected"]
            ], {}, class: "form-control" %>
          </div>

          <div class="form-group">
            <label class="form-label">Subscription Status</label>
            <%= f.select :subscription_status, [
              ["Free", "free"],
              ["Trial", "trial"],
              ["Active", "active"],
              ["Past Due", "past_due"],
              ["Cancelled", "cancelled"],
              ["Expired", "expired"]
            ], {}, class: "form-control" %>
          </div>

          <div class="form-group">
            <label class="form-label">Roles</label>
            <div style="display: flex; flex-direction: column; gap: var(--space-2);">
              <% %w[buyer seller service_provider admin].each do |role| %>
                <label style="display: flex; align-items: center; gap: var(--space-2); font-weight: normal;">
                  <input type="checkbox" name="user[roles][]" value="<%= role %>" <%= 'checked' if @user.roles.include?(role) %>>
                  <%= role.humanize %>
                </label>
              <% end %>
              <input type="hidden" name="user[roles][]" value="">
            </div>
          </div>

          <div style="display: flex; gap: var(--space-3); margin-top: var(--space-6);">
            <%= f.submit "Save Changes", class: "btn btn-primary" %>
            <%= link_to "Cancel", admin_user_path(@user), class: "btn btn-secondary" %>
          </div>
        <% end %>
      </div>
    </div>

    <%# User Summary %>
    <div>
      <div class="admin-panel mb-6">
        <div class="admin-panel-header">
          <h2 class="admin-panel-title">Current Status</h2>
        </div>
        <div class="admin-detail-list">
          <div class="admin-detail-row">
            <span class="admin-detail-label">ID</span>
            <span class="admin-detail-value">#<%= @user.id %></span>
          </div>
          <div class="admin-detail-row">
            <span class="admin-detail-label">Created</span>
            <span class="admin-detail-value"><%= @user.created_at.strftime("%b %d, %Y") %></span>
          </div>
          <div class="admin-detail-row">
            <span class="admin-detail-label">KYC Status</span>
            <span class="badge <%= kyc_status_badge_class(@user.kyc_status) %>">
              <%= @user.kyc_status&.humanize || "Pending" %>
            </span>
          </div>
          <div class="admin-detail-row">
            <span class="admin-detail-label">Subscription</span>
            <span class="badge <%= subscription_status_badge_class(@user.subscription_status) %>">
              <%= @user.subscription_status&.humanize || "Free" %>
            </span>
          </div>
          <div class="admin-detail-row">
            <span class="admin-detail-label">Suspended</span>
            <span class="admin-detail-value">
              <% if @user.suspended_at.present? %>
                <span class="badge badge-red">Yes</span>
              <% else %>
                <span class="badge badge-green">No</span>
              <% end %>
            </span>
          </div>
        </div>
      </div>

      <div class="admin-panel">
        <div class="admin-panel-header">
          <h2 class="admin-panel-title">Quick Actions</h2>
        </div>
        <div class="admin-quick-links">
          <%= link_to activity_admin_user_path(@user), class: "admin-quick-link" do %>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 20h9"/>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
            </svg>
            View Activity
          <% end %>
          <%= link_to ai_conversations_admin_user_path(@user), class: "admin-quick-link" do %>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            AI Conversations
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
