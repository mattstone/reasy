<div class="admin-content">
  <%# Page Header %>
  <div class="admin-page-header">
    <div>
      <h1 class="admin-page-title">Properties</h1>
      <p class="admin-page-subtitle">Manage platform property listings</p>
    </div>
  </div>

  <%# Stats %>
  <div class="stat-cards-4 mb-6">
    <div class="metric-card metric-card-sm">
      <div class="metric-card-content">
        <div class="metric-card-value"><%= @total_properties %></div>
        <div class="metric-card-label">Total Properties</div>
      </div>
    </div>
    <div class="metric-card metric-card-sm">
      <div class="metric-card-content">
        <div class="metric-card-value"><%= @active_count %></div>
        <div class="metric-card-label">Active</div>
      </div>
    </div>
    <div class="metric-card metric-card-sm">
      <div class="metric-card-content">
        <div class="metric-card-value"><%= @pending_count %></div>
        <div class="metric-card-label">Pending</div>
      </div>
    </div>
    <div class="metric-card metric-card-sm">
      <div class="metric-card-content">
        <div class="metric-card-value"><%= @sold_count %></div>
        <div class="metric-card-label">Sold</div>
      </div>
    </div>
  </div>

  <%# Filters %>
  <div class="admin-filters mb-4">
    <div class="filter-pills">
      <%= link_to "All", admin_properties_path, class: "filter-pill #{'filter-pill-active' if params[:status].blank?}" %>
      <%= link_to "Active", admin_properties_path(status: "active"), class: "filter-pill #{'filter-pill-active' if params[:status] == 'active'}" %>
      <%= link_to "Pending", pending_admin_properties_path, class: "filter-pill #{'filter-pill-active' if action_name == 'pending'}" %>
      <%= link_to "Sold", admin_properties_path(status: "sold"), class: "filter-pill #{'filter-pill-active' if params[:status] == 'sold'}" %>
    </div>

    <%= form_with url: admin_properties_path, method: :get, class: "admin-search-form" do %>
      <input type="text" name="q" value="<%= params[:q] %>" placeholder="Search by address..." class="form-control form-control-sm">
      <button type="submit" class="btn btn-sm btn-primary">Search</button>
    <% end %>
  </div>

  <%# Properties Table %>
  <div class="admin-panel">
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Property</th>
            <th>Seller</th>
            <th>Price</th>
            <th>Status</th>
            <th>Listed</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @properties.each do |property| %>
            <tr>
              <td>
                <div class="admin-property-card" style="padding: 0; border: none;">
                  <% if property.hero_image.attached? %>
                    <%= image_tag property.hero_image, class: "admin-property-image" %>
                  <% else %>
                    <div class="admin-property-image" style="display: flex; align-items: center; justify-content: center;">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--reasy-gray-300);">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                      </svg>
                    </div>
                  <% end %>
                  <div class="admin-property-info">
                    <%= link_to property.address, admin_property_path(property), class: "admin-property-address" %>
                    <span class="admin-property-details">
                      <%= property.suburb %>, <%= property.state %> <%= property.postcode %>
                    </span>
                    <span class="admin-property-details">
                      <%= property.bedrooms %> bed · <%= property.bathrooms %> bath · <%= property.parking_spaces %> car
                    </span>
                  </div>
                </div>
              </td>
              <td>
                <% if property.seller %>
                  <%= link_to property.seller.name, admin_user_path(property.seller), class: "user-cell-name" %>
                <% else %>
                  <span class="text-muted">N/A</span>
                <% end %>
              </td>
              <td>
                <span class="admin-property-price">
                  <%= property.price_cents ? number_to_currency(property.price_cents / 100, precision: 0) : "Not set" %>
                </span>
              </td>
              <td>
                <span class="badge badge-sm <%= property_status_badge_class(property.status) %>">
                  <%= property.status&.humanize || "Draft" %>
                </span>
                <% if property.featured? %>
                  <span class="badge badge-sm badge-orange">Featured</span>
                <% end %>
              </td>
              <td class="text-muted text-sm">
                <%= property.created_at.strftime("%b %d, %Y") %>
              </td>
              <td>
                <div class="table-actions">
                  <%= link_to admin_property_path(property), class: "btn btn-ghost btn-sm" do %>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  <% end %>
                  <%= link_to edit_admin_property_path(property), class: "btn btn-ghost btn-sm" do %>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <%# Pagination %>
    <% if @pagy.pages > 1 %>
      <div class="pagination-wrapper">
        <%== pagy_nav(@pagy) %>
      </div>
    <% end %>
  </div>
</div>
