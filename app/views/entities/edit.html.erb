<div class="layout">
  <%= render "shared/dashboard_sidebar" %>

  <main class="layout-main">
    <div class="content">
      <%# Page Header %>
      <div class="page-header">
        <div class="page-header-content">
          <div class="flex items-center gap-3">
            <h1 class="page-title">Edit Entity</h1>
            <% case @entity.entity_type %>
            <% when "individual" %>
              <span class="badge badge-blue">Individual</span>
            <% when "company" %>
              <span class="badge badge-purple">Company</span>
            <% when "smsf" %>
              <span class="badge badge-teal">SMSF</span>
            <% end %>
          </div>
          <p class="page-subtitle">Update details for <%= @entity.display_name %></p>
        </div>
        <div class="page-header-actions">
          <%= link_to entity_path(@entity), class: "btn btn-secondary" do %>
            Cancel
          <% end %>
          <button type="submit" form="entity_form" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Changes
          </button>
        </div>
      </div>

      <%# Verification Warning %>
      <% if @entity.verified? %>
        <div class="alert alert-warning mb-6">
          <div class="alert-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
          </div>
          <div class="alert-content">
            <div class="alert-title">Verified Entity</div>
            <div class="alert-description">This entity is verified. Some changes may require re-verification.</div>
          </div>
        </div>
      <% end %>

      <%= form_with model: @entity, url: entity_path(@entity), method: :patch, id: "entity_form" do |f| %>
        <%= render "form", f: f, entity: @entity %>

        <%# Form Actions (Bottom) %>
        <div class="form-actions form-actions-right">
          <%= link_to "Cancel", entity_path(@entity), class: "btn btn-secondary" %>
          <%= f.submit "Save Changes", class: "btn btn-primary" %>
        </div>
      <% end %>

      <%# Danger Zone %>
      <div class="dashboard-panel mt-8" style="border: 1px solid var(--color-error-pale);">
        <div class="dashboard-panel-header">
          <div>
            <h2 class="dashboard-panel-title" style="color: var(--color-error);">Danger Zone</h2>
            <p class="dashboard-panel-subtitle">Irreversible actions for this entity</p>
          </div>
        </div>

        <div class="flex items-center justify-between p-4" style="background: var(--color-error-pale); border-radius: var(--radius-lg);">
          <div>
            <div class="font-semibold">Delete this entity</div>
            <div class="text-small text-muted">Once deleted, this entity cannot be recovered. Any associated transactions will be affected.</div>
          </div>
          <%= button_to entity_path(@entity), method: :delete, class: "btn btn-danger", data: { turbo_confirm: "Are you sure you want to delete this entity? This action cannot be undone and may affect associated transactions." } do %>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"/>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            </svg>
            Delete Entity
          <% end %>
        </div>
      </div>
    </div>
  </main>
</div>
