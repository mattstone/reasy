
      <%# Page Header %>
      <div class="page-header">
        <div class="page-header-content">
          <h1 class="page-title">Edit Provider Profile</h1>
          <p class="page-subtitle">Update your business details and service offerings</p>
        </div>
        <div class="page-header-actions">
          <%= link_to provider_profile_path, class: "btn btn-secondary" do %>
            Cancel
          <% end %>
          <button type="submit" form="provider_profile_form" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Changes
          </button>
        </div>
      </div>

      <%= form_with model: @provider_profile, url: provider_profile_path, method: :patch, id: "provider_profile_form" do |f| %>
        <%# Business Details Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Business Details</h2>
              <p class="dashboard-panel-subtitle">Your core business information</p>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <%= f.label :business_name, "Business Name", class: "form-label form-label-required" %>
              <%= f.text_field :business_name, class: "form-input", placeholder: "e.g. Smith & Co Conveyancing" %>
            </div>

            <div class="form-group">
              <%= f.label :service_type, "Service Type", class: "form-label form-label-required" %>
              <%= f.select :service_type,
                    options_for_select(
                      ServiceProviderProfile::SERVICE_TYPES.map { |t| [t.humanize.titleize, t] },
                      @provider_profile.service_type
                    ),
                    { include_blank: "Select service type..." },
                    class: "form-select" %>
            </div>
          </div>

          <div class="form-group">
            <%= f.label :description, "Business Description", class: "form-label" %>
            <%= f.text_area :description, class: "form-textarea", rows: 4, placeholder: "Describe your business, experience, and what sets you apart..." %>
            <p class="form-help">This will be displayed on your public profile</p>
          </div>

          <div class="form-row">
            <div class="form-group">
              <%= f.label :abn, "ABN", class: "form-label" %>
              <%= f.text_field :abn, class: "form-input", placeholder: "11 digit ABN", maxlength: 11 %>
              <p class="form-help">Your Australian Business Number (11 digits)</p>
            </div>

            <div class="form-group">
              <%= f.label :license_number, "License Number", class: "form-label" %>
              <%= f.text_field :license_number, class: "form-input", placeholder: "e.g. NSW12345" %>
              <p class="form-help">Professional license or registration number</p>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <%= f.label :years_experience, "Years of Experience", class: "form-label" %>
              <%= f.number_field :years_experience, class: "form-input", min: 0, max: 100, placeholder: "e.g. 10" %>
            </div>

            <div class="form-group">
              <%= f.label :phone, "Business Phone", class: "form-label" %>
              <%= f.telephone_field :phone, class: "form-input", placeholder: "e.g. 02 9000 0000" %>
            </div>
          </div>

          <div class="form-group">
            <%= f.label :website, "Website", class: "form-label" %>
            <%= f.url_field :website, class: "form-input", placeholder: "https://www.example.com" %>
          </div>
        </div>

        <%# Service Areas Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Service Areas</h2>
              <p class="dashboard-panel-subtitle">Where do you provide your services?</p>
            </div>
          </div>

          <div class="form-group">
            <%= f.label :service_areas, "Service Areas", class: "form-label" %>
            <%= f.text_field :service_areas,
                  value: @provider_profile.service_areas&.join(", "),
                  class: "form-input",
                  placeholder: "e.g. Sydney CBD, North Sydney, Parramatta, Eastern Suburbs" %>
            <p class="form-help">Enter suburb names or regions separated by commas</p>
          </div>
        </div>

        <%# Credentials Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Credentials</h2>
              <p class="dashboard-panel-subtitle">Professional qualifications and certifications</p>
            </div>
          </div>

          <div id="credentials-list">
            <% if @provider_profile.credentials.present? && @provider_profile.credentials.any? %>
              <% @provider_profile.credentials.each_with_index do |credential, index| %>
                <div class="credential-item flex items-start gap-4 p-4 mb-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg);">
                  <div class="flex-1">
                    <div class="form-row">
                      <div class="form-group mb-0">
                        <label class="form-label">Credential Name</label>
                        <input type="text" name="provider_profile[credentials][][name]" value="<%= credential['name'] %>" class="form-input" placeholder="e.g. Licensed Conveyancer">
                      </div>
                      <div class="form-group mb-0">
                        <label class="form-label">Issuing Organisation</label>
                        <input type="text" name="provider_profile[credentials][][issuer]" value="<%= credential['issuer'] %>" class="form-input" placeholder="e.g. NSW Fair Trading">
                      </div>
                    </div>
                  </div>
                  <button type="button" class="btn btn-ghost btn-sm remove-credential" style="margin-top: 28px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18"/>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    </svg>
                  </button>
                </div>
              <% end %>
            <% end %>
          </div>

          <button type="button" id="add-credential" class="btn btn-secondary btn-sm">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Add Credential
          </button>

          <template id="credential-template">
            <div class="credential-item flex items-start gap-4 p-4 mb-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg);">
              <div class="flex-1">
                <div class="form-row">
                  <div class="form-group mb-0">
                    <label class="form-label">Credential Name</label>
                    <input type="text" name="provider_profile[credentials][][name]" class="form-input" placeholder="e.g. Licensed Conveyancer">
                  </div>
                  <div class="form-group mb-0">
                    <label class="form-label">Issuing Organisation</label>
                    <input type="text" name="provider_profile[credentials][][issuer]" class="form-input" placeholder="e.g. NSW Fair Trading">
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-ghost btn-sm remove-credential" style="margin-top: 28px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18"/>
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                </svg>
              </button>
            </div>
          </template>

          <script>
            document.addEventListener('DOMContentLoaded', function() {
              const addBtn = document.getElementById('add-credential');
              const list = document.getElementById('credentials-list');
              const template = document.getElementById('credential-template');

              addBtn.addEventListener('click', function() {
                const clone = template.content.cloneNode(true);
                list.appendChild(clone);
              });

              list.addEventListener('click', function(e) {
                if (e.target.closest('.remove-credential')) {
                  e.target.closest('.credential-item').remove();
                }
              });
            });
          </script>
        </div>

        <%# Differentiators Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Differentiators</h2>
              <p class="dashboard-panel-subtitle">What makes your service stand out?</p>
            </div>
          </div>

          <div class="form-group">
            <div class="grid grid-cols-2 gap-4">
              <% differentiator_info = {
                   "same_day_response" => { icon: "zap", description: "Respond to enquiries same day" },
                   "available_weekends" => { icon: "calendar", description: "Available for appointments on weekends" },
                   "same_day_reports" => { icon: "file-text", description: "Deliver reports same day" },
                   "free_consultation" => { icon: "message-circle", description: "Offer free initial consultation" },
                   "fixed_pricing" => { icon: "dollar-sign", description: "Clear, fixed pricing with no surprises" },
                   "online_booking" => { icon: "calendar-plus", description: "Book appointments online" },
                   "after_hours_available" => { icon: "moon", description: "Available outside business hours" },
                   "emergency_service" => { icon: "alert-circle", description: "Emergency or urgent service available" }
                 } %>
              <% ServiceProviderProfile::DIFFERENTIATORS.each do |diff| %>
                <div class="form-check p-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg);">
                  <%= check_box_tag "provider_profile[differentiators][]", diff,
                        @provider_profile.differentiators&.include?(diff),
                        id: "diff_#{diff}",
                        class: "form-check-input" %>
                  <label for="diff_<%= diff %>" class="form-check-label" style="cursor: pointer;">
                    <span class="font-semibold flex items-center gap-2">
                      <% case differentiator_info[diff][:icon] %>
                      <% when "zap" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                      <% when "calendar" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                          <line x1="16" y1="2" x2="16" y2="6"/>
                          <line x1="8" y1="2" x2="8" y2="6"/>
                        </svg>
                      <% when "file-text" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                          <path d="M14 2v6h6"/>
                          <path d="M16 13H8"/>
                          <path d="M16 17H8"/>
                        </svg>
                      <% when "message-circle" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>
                        </svg>
                      <% when "dollar-sign" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                      <% when "calendar-plus" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                          <line x1="16" y1="2" x2="16" y2="6"/>
                          <line x1="8" y1="2" x2="8" y2="6"/>
                          <path d="M12 11v6"/>
                          <path d="M9 14h6"/>
                        </svg>
                      <% when "moon" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                        </svg>
                      <% when "alert-circle" %>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <circle cx="12" cy="12" r="10"/>
                          <line x1="12" y1="8" x2="12" y2="12"/>
                          <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                      <% end %>
                      <%= diff.humanize.titleize %>
                    </span>
                    <span class="text-small text-muted block mt-1"><%= differentiator_info[diff][:description] %></span>
                  </label>
                </div>
              <% end %>
            </div>
            <%= hidden_field_tag "provider_profile[differentiators][]", "" %>
          </div>
        </div>

        <%# Availability Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Availability</h2>
              <p class="dashboard-panel-subtitle">When are you available for work?</p>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Available Times</label>
            <div class="form-check-group">
              <div class="form-check p-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg); margin-bottom: var(--space-2);">
                <%= check_box_tag "provider_profile[availability][weekdays]", "true",
                      @provider_profile.available_weekdays?,
                      id: "avail_weekdays",
                      class: "form-check-input" %>
                <label for="avail_weekdays" class="form-check-label" style="cursor: pointer;">
                  <span class="font-semibold flex items-center gap-2">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                      <line x1="16" y1="2" x2="16" y2="6"/>
                      <line x1="8" y1="2" x2="8" y2="6"/>
                      <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Weekdays
                  </span>
                  <span class="text-small text-muted block mt-1">Monday to Friday, standard business hours</span>
                </label>
              </div>

              <div class="form-check p-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg); margin-bottom: var(--space-2);">
                <%= check_box_tag "provider_profile[availability][weekends]", "true",
                      @provider_profile.availability["weekends"],
                      id: "avail_weekends",
                      class: "form-check-input" %>
                <label for="avail_weekends" class="form-check-label" style="cursor: pointer;">
                  <span class="font-semibold flex items-center gap-2">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="4"/>
                      <path d="M12 2v2"/>
                      <path d="M12 20v2"/>
                      <path d="m4.93 4.93 1.41 1.41"/>
                      <path d="m17.66 17.66 1.41 1.41"/>
                    </svg>
                    Weekends
                  </span>
                  <span class="text-small text-muted block mt-1">Saturday and Sunday appointments</span>
                </label>
              </div>

              <div class="form-check p-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg);">
                <%= check_box_tag "provider_profile[availability][after_hours]", "true",
                      @provider_profile.available_after_hours?,
                      id: "avail_after_hours",
                      class: "form-check-input" %>
                <label for="avail_after_hours" class="form-check-label" style="cursor: pointer;">
                  <span class="font-semibold flex items-center gap-2">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                    After Hours
                  </span>
                  <span class="text-small text-muted block mt-1">Available outside standard business hours</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <%# Response Time Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Response Time</h2>
              <p class="dashboard-panel-subtitle">How quickly do you respond to enquiries?</p>
            </div>
          </div>

          <div class="form-group">
            <%= f.label :response_time_commitment, "Response Time Commitment", class: "form-label" %>
            <div class="form-check-group">
              <% response_options = [
                   ["same_day", "Same Day", "Respond to all enquiries within the same business day"],
                   ["24_hours", "Within 24 Hours", "Respond within one business day"],
                   ["48_hours", "Within 48 Hours", "Respond within two business days"],
                   ["3_days", "Within 3 Days", "Respond within three business days"]
                 ] %>
              <% response_options.each do |value, label, description| %>
                <div class="form-check p-3" style="background: var(--color-gray-50); border-radius: var(--radius-lg); margin-bottom: var(--space-2);">
                  <%= f.radio_button :response_time_commitment, value, class: "form-check-input", id: "response_#{value}" %>
                  <label for="response_<%= value %>" class="form-check-label" style="cursor: pointer;">
                    <span class="font-semibold"><%= label %></span>
                    <span class="text-small text-muted block mt-1"><%= description %></span>
                  </label>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <%# Accepting Clients Section %>
        <div class="dashboard-panel mb-6">
          <div class="dashboard-panel-header">
            <div>
              <h2 class="dashboard-panel-title">Client Availability</h2>
              <p class="dashboard-panel-subtitle">Are you currently accepting new clients?</p>
            </div>
          </div>

          <div class="form-group">
            <div class="form-toggle">
              <%= f.check_box :accepting_new_clients, class: "form-toggle-input", id: "accepting_clients" %>
              <label for="accepting_clients" class="form-toggle-label">
                <span class="font-semibold">Accepting New Clients</span>
              </label>
            </div>
            <p class="form-help mt-2">When enabled, your profile will show that you're available for new work and you'll receive lead notifications</p>
          </div>

          <% if @provider_profile.verified? %>
            <div class="alert alert-info mt-4">
              <div class="alert-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 16v-4"/>
                  <path d="M12 8h.01"/>
                </svg>
              </div>
              <div class="alert-content">
                <div class="alert-description">Your profile is verified. You'll appear in search results when accepting clients.</div>
              </div>
            </div>
          <% elsif @provider_profile.pending_verification? %>
            <div class="alert alert-warning mt-4">
              <div class="alert-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                  <line x1="12" y1="9" x2="12" y2="13"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              </div>
              <div class="alert-content">
                <div class="alert-title">Verification Pending</div>
                <div class="alert-description">Your profile is awaiting verification. You won't appear in search results until verified.</div>
              </div>
            </div>
          <% end %>
        </div>

        <%# Form Actions (Bottom) %>
        <div class="form-actions form-actions-right">
          <%= link_to "Cancel", provider_profile_path, class: "btn btn-secondary" %>
          <%= f.submit "Save Changes", class: "btn btn-primary" %>
        </div>
      <% end %>
