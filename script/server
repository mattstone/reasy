#!/usr/bin/env bash

# Reasy Development Server Script
# Restarts the Rails server and tails the development log

set -e

cd "$(dirname "$0")/.."

echo "ðŸ”„ Stopping any running Rails servers..."

# Kill any process using port 3002
lsof -ti :3002 | xargs kill -9 2>/dev/null || true

# Kill Rails/Puma processes
pkill -f "puma.*reasy" 2>/dev/null || true
pkill -f "rails server" 2>/dev/null || true

# Give processes time to stop
sleep 1

# Remove stale PID file
rm -f tmp/pids/server.pid

echo "ðŸ§¹ Clearing logs..."
> log/development.log

echo "ðŸš€ Starting Rails server on port 3002..."
echo "âœ… Server will be available at http://localhost:3002"
echo "   Press Ctrl+C to stop"
echo "================================================"
echo ""

bin/rails server -p 3002
