#!/usr/bin/env ruby
# frozen_string_literal: true

# Script to combine all CSS files into application.css
# Run this when you modify individual CSS files in stylesheets/base/, components/, layouts/, or pages/

require "fileutils"

STYLESHEETS_DIR = File.expand_path("../app/assets/stylesheets", __dir__)
OUTPUT_FILE = File.join(STYLESHEETS_DIR, "application.css")

# Order matters for CSS cascade
CSS_FILES = [
  # Base layer
  "base/variables.css",
  "base/reset.css",
  "base/typography.css",
  # Components layer
  "components/buttons.css",
  "components/cards.css",
  "components/badges.css",
  "components/forms.css",
  "components/navigation.css",
  "components/alerts.css",
  "components/tables.css",
  "components/scores.css",
  "components/journey.css",
  "components/ai_badges.css",
  "components/ai_analysis.css",
  # Layouts layer
  "layouts/grid.css",
  "layouts/dashboard.css",
  # Pages layer
  "pages/auth.css",
  "pages/ai-chat.css",
  "pages/map.css",
  "pages/home.css",
  "pages/offers.css",
  "pages/subscription.css",
  "pages/messaging.css",
  "pages/reviews.css",
  "pages/co-users.css",
  "pages/documents.css",
  "pages/admin.css",
  "pages/index1.css",
  "pages/index2.css",
  "pages/index3.css",
  "pages/index4.css",
  "pages/index5.css",
  "pages/property-show.css",
  "pages/properties-index.css"
].freeze

HEADER = <<~CSS
  /*
   * Reasy - Main Application Stylesheet
   * Apple HIG-inspired design system
   *
   * This file contains all CSS modules concatenated:
   * - base/: Design tokens, reset, typography
   * - components/: Reusable UI components
   * - layouts/: Page layout patterns
   * - pages/: Page-specific styles
   *
   * Note: CSS files are concatenated rather than using @import
   * for compatibility with Propshaft asset pipeline.
   *
   * DO NOT EDIT THIS FILE DIRECTLY!
   * Edit the individual CSS files and run: bin/combine_css
   */

CSS

def main
  puts "Combining CSS files..."

  combined = HEADER.dup

  CSS_FILES.each do |file|
    path = File.join(STYLESHEETS_DIR, file)
    if File.exist?(path)
      combined << "/* ================================================\n"
      combined << "   #{file}\n"
      combined << "   ================================================ */\n\n"
      combined << File.read(path)
      combined << "\n\n"
      puts "  Added: #{file}"
    else
      puts "  WARNING: Missing file: #{file}"
    end
  end

  File.write(OUTPUT_FILE, combined)
  puts "\nCreated: app/assets/stylesheets/application.css"
  puts "Total lines: #{combined.lines.count}"
end

main
